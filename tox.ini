# Tox configuration for advanced testing environments
[tox]
envlist = 
    py{39,310,311,312}
    security
    docs
    type-check
    benchmark
isolated_build = true
skip_missing_interpreters = true

[gh-actions]
python =
    3.9: py39
    3.10: py310
    3.11: py311, type-check, security
    3.12: py312, docs, benchmark

[testenv]
deps = 
    -r{toxinidir}/requirements-dev.txt
    .[security]
commands = 
    pytest {posargs:tests/} --cov=docker_optimizer --cov-report=xml

[testenv:security]
deps = 
    bandit[toml]>=1.7.0
    safety>=2.0.0
    semgrep>=1.0.0
commands = 
    bandit -r src/ -c pyproject.toml
    safety check --json
    # semgrep --config=auto src/

[testenv:type-check]
deps = 
    mypy>=1.0.0
    types-PyYAML
    types-requests
    types-click
commands = mypy src/

[testenv:docs]
deps = 
    sphinx>=5.0.0
    sphinx-rtd-theme>=1.2.0
    myst-parser>=0.18.0
changedir = docs
commands = sphinx-build -W -b html . _build/html

[testenv:benchmark]
deps = 
    {[testenv]deps}
    pytest-benchmark>=4.0.0
    memory-profiler>=0.60.0
commands = 
    pytest benchmarks/ --benchmark-only --benchmark-json=benchmark_results.json

[testenv:lint]
deps = 
    ruff>=0.1.0
    black>=23.0.0
commands = 
    ruff check src/ tests/
    black --check src/ tests/

[testenv:format]
deps = 
    ruff>=0.1.0
    black>=23.0.0
    isort>=5.12.0
commands = 
    black src/ tests/
    isort src/ tests/
    ruff check --fix src/ tests/